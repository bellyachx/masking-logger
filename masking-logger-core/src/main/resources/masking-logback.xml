<configuration>
    <include resource="org/springframework/boot/logging/logback/defaults.xml"/>

    <import class="me.maxhub.logger.logback.encoder.MaskingJsonEncoder"/>
    <import class="ch.qos.logback.classic.encoder.PatternLayoutEncoder"/>

    <import class="ch.qos.logback.core.rolling.IndexBasedRollingPolicy"/>
    <import class="ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy"/>
    <import class="ch.qos.logback.core.rolling.RollingFileAppender"/>
    <import class="ch.qos.logback.core.ConsoleAppender"/>

    <import class="me.maxhub.logger.logback.filter.LoggerNameFilter"/>
    <import class="ch.qos.logback.classic.filter.ThresholdFilter"/>

    <property name="MESSAGES_LOG_FILE" value="${logger.dir:-./logs}/messages-%i.log"/>

    <appender name="STDOUT" class="ConsoleAppender">
        <encoder class="PatternLayoutEncoder">
            <outputPatternAsHeader>true</outputPatternAsHeader>
            <pattern>${CONSOLE_LOG_PATTERN}</pattern>
        </encoder>
    </appender>

    <appender level="info" name="rollingFile" class="RollingFileAppender">
        <filter class="ThresholdFilter">
            <level>INFO</level>
        </filter>

        <filter class="LoggerNameFilter">
            <include>${LOGGER_TO_INCLUDE:-}</include>
            <ignore>me.maxhub.logger.aop.http.RequestMappingInterceptor</ignore>
            <ignore>me.maxhub.logging</ignore>
            <ignore>${LOGGER_TO_IGNORE:-}</ignore>
        </filter>

        <rollingPolicy class="IndexBasedRollingPolicy">
            <fileNamePattern>${MESSAGES_LOG_FILE}</fileNamePattern>
            <minIndex>1</minIndex>
            <maxIndex>5</maxIndex>
        </rollingPolicy>

        <triggeringPolicy class="SizeBasedTriggeringPolicy">
            <maxFileSize>10MB</maxFileSize>
            <!-- to disable the timeout, set checkIncrement to 0S-->
<!--            <checkIncrement>0S</checkIncrement>-->
        </triggeringPolicy>

        <encoder class="MaskingJsonEncoder">
            <propertiesProvider>${PROPS_PROVIDER:-other}</propertiesProvider>
        </encoder>
    </appender>
</configuration>
